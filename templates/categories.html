<style>
    /* CSS Global (di-copy dari layout.html untuk halaman ini) */
    :root {
        --primary-blue: #4A47A3;
        --light-purple: #E6E6FA;
        --text-dark: #333;
        --text-light: #888;
        --expense-red: #E84545;
        --income-green: #51CF66;
        --bg-gray: #f4f5f9;
    }
    .dark body { background-color: #111827; }
    .dark .category-page-container { background-color: #111827; }

    /* CSS Khusus untuk Halaman Kategori */
    .category-page-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        height: 100svh;
        max-width: 480px;
        margin: 0 auto;
        background-color: var(--bg-gray);
    }
    .category-header {
        background: var(--primary-blue);
        color: white;
        padding: 20px;
        flex-shrink: 0;
        z-index: 10;
        border-bottom-left-radius: 25px;
        border-bottom-right-radius: 25px;
    }
    .category-header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 18px;
        font-weight: 600;
    }
    .category-header-top .back-link {
        color: white;
        text-decoration: none;
        font-size: 20px;
    }

    /* Styling Tab Primer (Tombol Ungu/Putih) */
    .primary-tab-container {
        display: flex;
        justify-content: center;
        background-color: var(--bg-gray);
        padding: 15px 20px 10px 20px;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bg-gray);
        gap: 10px;
    }
    .dark .primary-tab-container {
        background-color: #111827;
        border-bottom-color: #111827;
    }
    .primary-tab-btn {
        font-size: 14px;
        font-weight: 500;
        background: white;
        border: 1px solid #e9ecef;
        padding: 10px 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-grow: 1;
        text-align: center;
        max-width: 50%;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .primary-tab-btn.expense-tab { color: var(--text-dark); }
    .primary-tab-btn.expense-tab .icon-expense { color: var(--expense-red); }
    .primary-tab-btn.income-tab { color: var(--text-dark); }
    .primary-tab-btn.income-tab .icon-income { color: var(--income-green); }
    .primary-tab-btn.active {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
        font-weight: 600;
    }
    .primary-tab-btn.active .icon-expense,
    .primary-tab-btn.active .icon-income {
        color: white;
    }
    .dark .primary-tab-btn {
        background: #374151;
        border-color: #4b5563;
        color: #d1d5db;
    }
    .dark .primary-tab-btn.expense-tab .icon-expense { color: var(--expense-red); }
    .dark .primary-tab-btn.income-tab .icon-income { color: var(--income-green); }
    .dark .primary-tab-btn.active {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
    }
    .dark .primary-tab-btn.active .icon-expense,
    .dark .primary-tab-btn.active .icon-income {
        color: white;
    }

    /* Konten Utama */
    .category-content {
        flex-grow: 1;
        overflow-y: auto;
        padding: 15px 20px 100px 20px;
        position: relative;
    }
    
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .category-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(95px, 1fr)); 
        gap: 15px;
    }

    /* .category-item (Kartu) */
    .category-item {
        background-color: white;
        border-radius: 18px;
        padding: 15px;
        text-align: center;
        text-decoration: none;
        color: var(--text-dark);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        aspect-ratio: 1 / 1;
        box-shadow: 0 4px 25px rgba(0, 0, 0, 0.06);
        border-bottom: none;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }
    .category-item.visible {
        opacity: 1;
        transform: translateY(0);
    }
    .category-item:hover {
        background-color: #f8f9fa;
    }
    .dark .category-item {
        background-color: #374151;
        color: #d1d5db;
        box-shadow: none;
    }
    .dark .category-item:hover {
        background-color: #4b5563;
    }
    .category-item:last-child { 
        border-bottom: none; 
    }
    
    .category-item-icon {
        font-size: 36px;
        width: 50px;
        height: 50px;
        background-color: var(--light-purple);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        margin-right: 0;
        margin-bottom: 8px;
    }
    .dark .category-item-icon { 
        background-color: #4b5563; 
    }
    
    .category-item-details {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-dark);
        margin-bottom: 10px;
        text-align: center;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis; 
    }
    .dark .category-item-details { color: white; }
    
    .category-item-actions { 
        display: flex; 
        gap: 15px;
        justify-content: center;
    }
    .category-item-actions button {
        background: var(--bg-gray);
        border: none; 
        font-size: 13px;
        color: var(--text-light); 
        cursor: pointer;
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s;
    }
    .category-item-actions button:hover {
        background-color: #e0e0e0;
    }
    .category-item-actions button.delete {
        color: var(--expense-red);
    }
    .category-item-actions button.delete:hover {
        background-color: #ffe3e3;
    }
    
    .dark .category-item-actions button {
        background-color: #4b5563;
        color: #d1d5db;
    }
    .dark .category-item-actions button:hover {
        background-color: #5a6678;
    }
    .dark .category-item-actions button.delete {
        color: var(--expense-red);
    }
    .dark .category-item-actions button.delete:hover {
        background-color: #5c2c2c;
    }

    /* Spinner Preloader Halaman */
    #category-list-preloader {
        display: none;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 60px 20px;
    }
    #category-list-preloader .inline-spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border-width: 3px;
        border-color: var(--primary-blue);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s ease-in-out infinite;
    }
    .dark #category-list-preloader .inline-spinner {
        border-color: white;
        border-top-color: transparent;
    }
    #category-list-error {
        display: none;
        text-align: center;
        padding: 40px 20px;
        color: var(--expense-red);
    }
    .loading-spinner {
        display: none; width: 1rem; height: 1rem;
        border: 2px solid white;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* [PERBAIKAN KUNCI] CSS untuk Modal */
    .form-group { margin-bottom: 15px; }
    .form-group label {
        display: block; font-size: 13px; font-weight: 500;
        color: var(--text-light); margin-bottom: 8px;
    }
    
    /* Style Input Field (Nama Kategori, Ikon) */
    .form-group .input-field {
        width: 100%; 
        padding: 12px; 
        border: 1px solid #e0e0e0;
        border-radius: 10px; 
        background-color: var(--bg-gray);
        font-size: 14px;
    }

    /* Style Select Field (Tipe Kategori) */
    .form-group .select-field {
        width: 100%; 
        padding: 12px; 
        border: 1px solid #e0e0e0;
        border-radius: 10px; 
        background-color: var(--bg-gray);
        font-size: 14px;
        
        /* Hapus tampilan asli browser */
        -webkit-appearance: none;
        appearance: none;
        
        /* Tambah ruang untuk panah kustom */
        padding-right: 40px; 
        
        /* Panah kustom (chevron down) warna abu-abu */
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%23888%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%20%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1.25em 1.25em;
    }

    /* Dark Mode untuk Input */
    .dark .form-group .input-field {
        background-color: #4b5563; 
        border-color: #4b5563; 
        color: white;
    }
    
    /* Dark Mode untuk Select */
    .dark .form-group .select-field {
        background-color: #4b5563; 
        border-color: #4b5563; 
        color: white;
        /* Ganti panah SVG jadi warna putih */
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%23FFFFFF%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%20%2F%3E%3C%2Fsvg%3E');
    }
    /* [AKHIR PERBAIKAN CSS MODAL] */
    
    .form-group .submit-btn {
        width: 100%; background: var(--primary-blue); color: white;
        border: none; padding: 12px; border-radius: 10px;
        font-weight: 600; cursor: pointer; display: inline-flex;
        align-items: center; justify-content: center; gap: 8px;
    }
    .form-group .submit-btn:disabled {
        background-color: #9ca3af; cursor: not-allowed;
    }
    #modal-category-message {
        font-size: 13px; margin-top: 10px; text-align: center;
    }
    #modal-category-message.success { color: var(--income-green); }
    #modal-category-message.error { color: var(--expense-red); }

    /* Ini sudah benar, adalah style untuk input ikon */
    .icon-input-modal {
        width: 60px !important; text-align: center;
        font-size: 24px !important; padding: 5px 10px !important;
        /* Ini adalah bagian dari .input-field, jadi sudah otomatis ter-style */
    }
</style>

<div class="category-page-container">
    <header class="category-header">
        <div class="category-header-top">
            <a href="/more" class="back-link"><i class="fas fa-chevron-left"></i></a>
            <span>Manajemen Kategori</span>
            <a href="#" class="back-link" style="font-size: 22px;" onclick="openAddCategoryModal()">
                <i class="fas fa-plus"></i>
            </a> 
        </div>
    </header>

    <div class="primary-tab-container">
        <button class="primary-tab-btn expense-tab active" id="cat-tab-expense" onclick="selectCategoryTab('EXPENSE')">
            <i class="fas fa-minus icon-expense"></i>
            <span>Pengeluaran</span>
        </button>
        <button class="primary-tab-btn income-tab" id="cat-tab-income" onclick="selectCategoryTab('INCOME')">
            <i class="fas fa-plus icon-income"></i>
            <span>Pemasukan</span>
        </button>
    </div>

    <main class="category-content">
        
        <div id="category-list-preloader">
            <span class="inline-spinner"></span>
        </div>

        <div id="category-list-error"></div>

        <div class="tab-panel active" id="category-panel-EXPENSE" style="display: none;">
            <div class="category-grid-container" id="category-list-EXPENSE">
                </div>
        </div>

        <div class="tab-panel" id="category-panel-INCOME" style="display: none;">
            <div class="category-grid-container" id="category-list-INCOME">
                </div>
        </div>
        
    </main>

    <footer class="bottom-nav">
        <a href="/" class="nav-item"><i class="fas fa-book"></i><span>Transaksi</span></a>
        <a href="/wallet" class="nav-item"><i class="fas fa-wallet"></i><span>Akun</span></a>
        <a href="/analysis" class="nav-item"><i class="fas fa-chart-pie"></i><span>Analisis</span></a>
        <a href="/more" class="nav-item active"><i class="fas fa-ellipsis-h"></i><span>Lebih</span></a>
    </footer>
</div>

<div id="category-modal-overlay" class="tx-modal-overlay" onclick="closeCategoryModal()">
    <div class="tx-modal-content" onclick="event.stopPropagation()">
        <div class="tx-modal-header">
            <h3 id="category-modal-title" style="font-weight: 600; font-size: 18px;">Tambah Kategori</h3>
            <button class="tx-modal-close" onclick="closeCategoryModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="tx-modal-body" style="padding-top: 15px;">
            <form id="category-form">
                <input type="hidden" id="category-id">
                <div class="form-group" style="display: flex; gap: 10px;">
                    <div style="width: 60px;">
                         <label for="category-icon">Ikon</label>
                         <input type="text" id="category-icon" class="input-field icon-input-modal" maxlength="2" placeholder="ðŸ›ï¸">
                    </div>
                    <div style="flex-grow: 1;">
                        <label for="category-name">Nama Kategori</label>
                        <input type="text" id="category-name" class="input-field" placeholder="cth: Gaji, Makan, dll" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="category-type">Tipe Kategori</label>
                    <select id="category-type" class="select-field">
                        <option value="EXPENSE">Pengeluaran (Expense)</option>
                        <option value="INCOME">Pemasukan (Income)</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="submit-btn" id="category-submit-btn">
                        <span class="loading-spinner" id="category-spinner"></span>
                        <span>Simpan</span>
                    </button>
                </div>
                <div id="modal-category-message"></div>
            </form>
        </div>
    </div>
</div>