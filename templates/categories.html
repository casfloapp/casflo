<style>
    /* CSS Global (di-copy dari layout.html untuk halaman ini) */
    :root {
        --primary-blue: #4A47A3;
        --light-purple: #E6E6FA;
        --text-dark: #333;
        --text-light: #888;
        --expense-red: #E84545;
        --income-green: #51CF66;
        --bg-gray: #f4f5f9;
    }
    .dark body { background-color: #111827; }
    .dark .category-page-container { background-color: #111827; }

    /* CSS Khusus untuk Halaman Kategori */
    .category-page-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        height: 100svh;
        max-width: 480px;
        margin: 0 auto;
        background-color: var(--bg-gray);
    }
    .category-header {
        background: var(--primary-blue);
        color: white;
        padding: 20px;
        flex-shrink: 0;
        z-index: 10;
        border-bottom-left-radius: 25px;
        border-bottom-right-radius: 25px;
    }
    .category-header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 18px;
        font-weight: 600;
    }
    .category-header-top .back-link {
        color: white;
        text-decoration: none;
        font-size: 20px;
    }

    /* Styling Tab Primer (Pengeluaran/Pemasukan) */
    .primary-tab-container {
        display: flex;
        justify-content: center;
        background-color: var(--bg-gray);
        padding: 15px 20px 10px 20px;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bg-gray);
        gap: 10px;
    }
    .dark .primary-tab-container {
        background-color: #111827;
        border-bottom-color: #111827;
    }

    .primary-tab-btn {
        font-size: 14px;
        font-weight: 500;
        background: white;
        border: 1px solid #e9ecef;
        padding: 10px 16px;
        border-bottom: none;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-grow: 1;
        text-align: center;
        max-width: 50%;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .primary-tab-btn.expense-tab {
        color: var(--text-dark);
    }
    .primary-tab-btn.expense-tab .icon-expense {
        color: var(--expense-red);
    }

    .primary-tab-btn.income-tab {
        color: var(--text-dark);
    }
    .primary-tab-btn.income-tab .icon-income {
        color: var(--income-green);
    }

    .primary-tab-btn.active {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
        font-weight: 600;
    }
    .primary-tab-btn.active .icon-expense,
    .primary-tab-btn.active .icon-income {
        color: white;
    }

    /* Dark Mode untuk Tombol */
    .dark .primary-tab-btn {
        background: #374151;
        border-color: #4b5563;
        color: #d1d5db;
    }
    
    .dark .primary-tab-btn.expense-tab .icon-expense { color: var(--expense-red); }
    .dark .primary-tab-btn.income-tab .icon-income { color: var(--income-green); }

    .dark .primary-tab-btn.active {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
    }
    .dark .primary-tab-btn.active .icon-expense,
    .dark .primary-tab-btn.active .icon-income {
        color: white;
    }

    /* Konten Utama */
    .category-content {
        flex-grow: 1;
        overflow-y: auto;
        padding: 15px 20px 100px 20px;
        position: relative; /* Penting untuk positioning spinner */
    }
    
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* Card untuk Daftar Kategori (Grid) */
    .category-list-card {
        background-color: white;
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 4px 25px rgba(0,0,0,0.06);
        margin-bottom: 15px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); 
        gap: 20px;
    }
    .dark .category-list-card { background-color: #374151; }
    
    /* Item Kategori (Tumpukan Vertikal) */
    .category-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px 5px;
        border-bottom: none;
        border-radius: 10px;
        transition: background-color 0.2s;
    }
    .category-item:hover {
        background-color: var(--bg-gray);
    }
    .dark .category-item:hover {
        background-color: #4b5563;
    }

    .category-item:last-child { border-bottom: none; }
    .dark .category-item { border-bottom-color: transparent; }
    
    .category-item-icon {
        font-size: 36px;
        width: 50px;
        height: 50px;
        background-color: var(--light-purple);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        margin-right: 0;
        margin-bottom: 8px;
    }
    .dark .category-item-icon { 
        background-color: #4b5563; 
    }
    
    .category-item-details {
        flex-grow: 0;
        overflow: hidden;
        font-weight: 600;
        color: var(--text-dark);
        white-space: nowrap;
        text-overflow: ellipsis;
        margin-bottom: 10px;
        text-align: center;
        width: 100%;
    }
    .dark .category-item-details { color: white; }
    
    .category-item-actions { 
        display: flex; 
        gap: 15px;
        justify-content: center;
    }
    .category-item-actions button {
        background: none; border: none; font-size: 16px;
        color: var(--text-light); cursor: pointer;
    }
    .category-item-actions .delete { color: var(--expense-red); }

    /* [PERBAIKAN] Spinner untuk Preloader */
    .full-content-spinner {
        position: absolute; /* Posisikan absolut di dalam category-content */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); /* Pusatkan spinner */
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px; /* Ukuran spinner */
        height: 30px;
        border: 3px solid var(--primary-blue);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s ease-in-out infinite;
        z-index: 10;
        /* Tambahkan background agar terlihat jelas di atas konten */
        background-color: transparent; 
    }
    .dark .full-content-spinner {
        border-color: white; /* Spinner putih di dark mode */
        border-top-color: transparent;
    }

    /* Sembunyikan spinner internal di tombol modal jika ada */
    .loading-spinner {
        display: none;
        width: 1rem;
        height: 1rem;
        border: 2px solid white;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* CSS untuk Modal */
    .form-group { margin-bottom: 15px; }
    .form-group label {
        display: block; font-size: 13px; font-weight: 500;
        color: var(--text-light); margin-bottom: 8px;
    }
    .form-group .input-field,
    .form-group .select-field {
        width: 100%; padding: 12px; border: 1px solid #e0e0e0;
        border-radius: 10px; background-color: var(--bg-gray);
        font-size: 14px;
    }
    .dark .form-group .input-field,
    .dark .form-group .select-field {
        background-color: #4b5563; border-color: #4b5563; color: white;
    }
    .form-group .submit-btn {
        width: 100%; background: var(--primary-blue); color: white;
        border: none; padding: 12px; border-radius: 10px;
        font-weight: 600; cursor: pointer; display: inline-flex;
        align-items: center; justify-content: center; gap: 8px;
    }
    .form-group .submit-btn:disabled {
        background-color: #9ca3af; cursor: not-allowed;
    }
    #modal-category-message {
        font-size: 13px; margin-top: 10px; text-align: center;
    }
    #modal-category-message.success { color: var(--income-green); }
    #modal-category-message.error { color: var(--expense-red); }

    .icon-input-modal {
        width: 60px !important; text-align: center;
        font-size: 24px !important; padding: 5px 10px !important;
        border: 1px solid #e0e0e0; border-radius: 10px;
        background-color: var(--bg-gray);
    }
    .dark .icon-input-modal {
        background-color: #4b5563; border-color: #4b5563; color: white;
    }
</style>

<div class="category-page-container">
    <header class="category-header">
        <div class="category-header-top">
            <a href="/more" class="back-link"><i class="fas fa-chevron-left"></i></a>
            <span>Manajemen Kategori</span>
            <a href="#" class="back-link" style="font-size: 22px;" onclick="openAddCategoryModal()">
                <i class="fas fa-plus"></i>
            </a> 
        </div>
    </header>

    <div class="primary-tab-container">
        <button class="primary-tab-btn expense-tab active" id="cat-tab-expense" onclick="selectCategoryTab('EXPENSE')">
            <i class="fas fa-minus icon-expense"></i>
            <span>Pengeluaran</span>
        </button>
        <button class="primary-tab-btn income-tab" id="cat-tab-income" onclick="selectCategoryTab('INCOME')">
            <i class="fas fa-plus icon-income"></i>
            <span>Pemasukan</span>
        </button>
    </div>

    <main class="category-content">
        
        <div class="tab-panel active" id="category-panel-EXPENSE">
            <div class="category-list-card" id="category-list-EXPENSE">
                </div>
        </div>

        <div class="tab-panel" id="category-panel-INCOME">
            <div class="category-list-card" id="category-list-INCOME">
                </div>
        </div>
        
        <div class="full-content-spinner" id="category-list-spinner"></div>

    </main>

    <footer class="bottom-nav">
        <a href="/" class="nav-item"><i class="fas fa-book"></i><span>Transaksi</span></a>
        <a href="/wallet" class="nav-item"><i class="fas fa-wallet"></i><span>Akun</span></a>
        <a href="/analysis" class="nav-item"><i class="fas fa-chart-pie"></i><span>Analisis</span></a>
        <a href="/more" class="nav-item active"><i class="fas fa-ellipsis-h"></i><span>Lebih</span></a>
    </footer>
</div>

<div id="category-modal-overlay" class="tx-modal-overlay" onclick="closeCategoryModal()">
    <div class="tx-modal-content" onclick="event.stopPropagation()">
        <div class="tx-modal-header">
            <h3 id="category-modal-title" style="font-weight: 600; font-size: 18px;">Tambah Kategori</h3>
            <button class="tx-modal-close" onclick="closeCategoryModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="tx-modal-body" style="padding-top: 15px;">
            <form id="category-form">
                <input type="hidden" id="category-id">
                <div class="form-group" style="display: flex; gap: 10px;">
                    <div style="width: 60px;">
                         <label for="category-icon">Ikon</label>
                         <input type="text" id="category-icon" class="icon-input-modal" maxlength="2" placeholder="刀">
                    </div>
                    <div style="flex-grow: 1;">
                        <label for="category-name">Nama Kategori</label>
                        <input type="text" id="category-name" class="input-field" placeholder="cth: Gaji, Makan, dll" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="category-type">Tipe Kategori</label>
                    <select id="category-type" class="select-field">
                        <option value="EXPENSE">Pengeluaran (Expense)</option>
                        <option value="INCOME">Pemasukan (Income)</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="submit-btn" id="category-submit-btn">
                        <span class="loading-spinner" id="category-spinner"></span>
                        <span>Simpan</span>
                    </button>
                </div>
                <div id="modal-category-message"></div>
            </form>
        </div>
    </div>
</div>