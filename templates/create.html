<style>
    /* [PERBAIKAN] CSS untuk Header Tombol (Pengeluaran, Pemasukan, Transfer) */
    .add-header {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background-color: white; /* Header background putih */
        box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* Sedikit shadow */
        flex-shrink: 0;
        z-index: 100;
        gap: 10px; /* Jarak antar elemen header */
    }
    .dark .add-header {
        background-color: #1f2937;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .close-btn, .check-btn {
        font-size: 20px;
        color: var(--text-light);
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        flex-shrink: 0; /* Jangan menyusut */
        text-decoration: none;
    }
    .dark .close-btn, .dark .check-btn { color: #d1d5db; }

    /* Tombol Selesai (Check) di kanan */
    .check-btn {
        color: var(--primary-blue);
        font-weight: 600;
    }
    .dark .check-btn { color: #6d8ee1; }

    /* Container untuk tombol Pengeluaran/Pemasukan/Transfer */
    .tab-button-group {
        display: flex;
        background-color: var(--bg-gray);
        border-radius: 12px;
        padding: 5px;
        flex-grow: 1; /* Agar group ini mengambil ruang tersisa */
    }
    .dark .tab-button-group { background-color: #374151; }

    .tab-button {
        flex-grow: 1;
        padding: 8px 10px;
        border: none;
        border-radius: 9px; /* Lebih kecil dari group */
        background-color: transparent;
        color: var(--text-dark);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px; /* Jarak ikon dan teks */
        text-decoration: none; /* Untuk tombol transfer yang jadi <a> */
    }
    .dark .tab-button { color: #d1d5db; }

    .tab-button.active {
        background-color: white;
        color: var(--primary-blue);
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .dark .tab-button.active {
        background-color: #1f2937;
        color: white;
    }

    /* Ikon di dalam tab-button */
    .tab-button i {
        font-size: 14px;
    }
    .tab-button.expense-tab.active i { color: var(--expense-red); }
    .tab-button.income-tab.active i { color: var(--income-green); }
    .tab-button.transfer-tab { 
        color: var(--text-dark); /* Selalu biru, walau tidak aktif */
    }
    .dark .tab-button.transfer-tab {
        color: #d1d5db;
    }
    
    /* [AKHIR PERBAIKAN] */
        
    .category-panel-container {
        flex-grow: 1;
        position: relative;
        overflow: hidden;
    }
    .category-panel {
        display: none;
        flex-direction: column;
        width: 100%;
        height: 100%;
        position: absolute;
    }
    .category-panel.active {
        display: flex;
    }

    .secondary-tab-container {
        display: flex;
        flex-shrink: 0;
        gap: 10px;
        padding: 10px 20px 0 20px;
        background-color: white;
        overflow-x: auto;
        border-bottom: 1px solid var(--bg-gray);
        align-items: center;
    }
    .dark .secondary-tab-container {
        background-color: #1f2937;
        border-bottom-color: #4b5563;
    }
    .secondary-tab-btn {
        padding: 8px 12px;
        border: none;
        background: var(--bg-gray);
        border-radius: 10px;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-dark);
        cursor: pointer;
        white-space: nowrap;
        flex-shrink: 0;
    }
    .secondary-tab-btn.active {
        background: var(--light-purple);
        color: var(--primary-blue);
        font-weight: 600;
    }
    .dark .secondary-tab-btn {
        background: #4b5563;
        color: #d1d5db;
    }
    .dark .secondary-tab-btn.active {
        background: #1f2937;
        color: white;
    }
    .category-settings-btn {
        margin-left: auto;
        padding: 8px 10px;
        border: none;
        background: var(--bg-gray);
        border-radius: 10px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-dark);
        cursor: pointer;
        white-space: nowrap;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-shrink: 0;
    }
    .category-settings-btn:hover {
        background: #e0e0e0;
    }
    .dark .category-settings-btn {
        background: #4b5563;
        color: #d1d5db;
    }
    .dark .category-settings-btn:hover {
        background: #5a6678;
    }

    .categories-section-wrapper {
        flex-grow: 1;
        overflow-y: auto;
        padding-bottom: 410px; 
        background-color: white;
    }
    .dark .categories-section-wrapper { background-color: #374151; }

    .categories-section {
        padding: 20px;
        min-height: 0;
        padding-bottom: 50px;
        display: none;
    }
    .categories-section.active {
        display: block;
    }
    .dark .categories-section { background-color: transparent; }
</style>

<div class="add-view active">
    <div class="add-header">
        <a href="/" class="close-btn"><i class="fas fa-times"></i></a>
        
        <div class="tab-button-group">
            <button class="tab-button expense-tab active" id="primary-tab-expense" onclick="selectPrimaryTab('expense')">
                <i class="fas fa-minus"></i>
                <span>Pengeluaran</span>
            </button>
            <button class="tab-button income-tab" id="primary-tab-income" onclick="selectPrimaryTab('income')">
                <i class="fas fa-plus"></i>
                <span>Pemasukan</span>
            </button>
            <a href="/transfer" class="tab-button transfer-tab" id="primary-tab-transfer">
                <i class="fas fa-exchange-alt"></i>
                <span>Transfer</span>
            </a>
        </div>
        
        <button class="check-btn" id="headerActionBtn" onclick="handleHeaderActionClick()">
            <i class="fas fa-check"></i>
        </button>
    </div>
    <div class="category-panel-container">
        <div class="category-panel active" id="expense-panel">
            <div class="secondary-tab-container">
                <button class="secondary-tab-btn active" onclick="selectSecondaryTab(this, 'expense-recommended')">Direkomendasikan</button>
                <button class="secondary-tab-btn" onclick="selectSecondaryTab(this, 'expense-all')">Semua</button>
                <a href="/categories" class="category-settings-btn">
                    <i class="fas fa-cog"></i>
                </a>
            </div>
            <div class="categories-section-wrapper">
                <div class="categories-section active" id="expense-recommended">
                    <div class="category-grid" id="recommendedGrid-expense"></div>
                </div>
                <div class="categories-section" id="expense-all">
                    <div class="category-grid" id="allGrid-expense"></div>
                </div>
            </div>
        </div>

        <div class="category-panel" id="income-panel">
            <div class="secondary-tab-container">
                <button class="secondary-tab-btn active" onclick="selectSecondaryTab(this, 'income-recommended')">Direkomendasikan</button>
                <button class="secondary-tab-btn" onclick="selectSecondaryTab(this, 'income-all')">Semua</button>
                <a href="/categories" class="category-settings-btn">
                    <i class="fas fa-cog"></i>
                </a>
            </div>
            <div class="categories-section-wrapper">
                <div class="categories-section active" id="income-recommended">
                    <div class="category-grid" id="recommendedGrid-income"></div>
                </div>
                <div class="categories-section" id="income-all">
                    <div class="category-grid" id="allGrid-income"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="calculator-section" id="main-calculator-section">
        <div id="calculator-view">
            <div class="amount-container">
                <button type="button" class="note-input-wrapper" onclick="openNotesView()">
                    <i class="fas fa-file-alt"></i>
                    <span id="notes-display-preview" class="notes-preview-text" data-placeholder="Catatan..."></span>
                </button>
                <div class="amount-display" id="amountDisplay">0</div>
            </div>
            <div class="unified-calc-grid">
                <button class="action-btn account" onclick="selectAccount()"><i class="fas fa-credit-card" id="account-icon-display"></i></button>
                <button class="action-btn today" onclick="selectDate()"><span id="create-date-display">TODAY</span></button>
                <button class="action-btn add" id="addBtn" onclick="addNewItem()"><i class="fas fa-plus"></i></button>
                <button class="action-btn check" id="actionBtn" onclick="handleActionClick()" style="display: none;">
                    <i class="fas fa-check"></i>
                </button>
                <button class="calc-btn operator" onclick="appendToCalc('*')">ร</button>
                <button class="calc-btn" onclick="appendToCalc('7')">7</button>
                <button class="calc-btn" onclick="appendToCalc('8')">8</button>
                <button class="calc-btn" onclick="appendToCalc('9')">9</button>
                <button class="calc-btn operator" onclick="appendToCalc('/')">รท</button>
                <button class="calc-btn" onclick="appendToCalc('4')">4</button>
                <button class="calc-btn" onclick="appendToCalc('5')">5</button>
                <button class="calc-btn" onclick="appendToCalc('6')">6</button>
                <button class="calc-btn operator" onclick="appendToCalc('-')">-</button>
                <button class="calc-btn" onclick="appendToCalc('1')">1</button>
                <button class="calc-btn" onclick="appendToCalc('2')">2</button>
                <button class="calc-btn" onclick="appendToCalc('3')">3</button>
                <button class="calc-btn operator" onclick="appendToCalc('+')">+</button>
                <button class="calc-btn" onclick="appendToCalc('.')">.</button>
                <button class="calc-btn" onclick="appendToCalc('0')">0</button>
                <button class="calc-btn delete" onclick="deleteLast()"><i class="fas fa-backspace"></i></button>
            </div>
        </div>
        <div id="notes-view">
             <div class="notes-view-header">
                <h3>Catatan Transaksi</h3>
                <button class="notes-view-save" onclick="closeNotesView(true)">Selesai</button>
            </div>
            <div class="notes-view-body">
                <textarea id="notes-modal-input" placeholder="Tulis catatan di sini max 50 char" maxlength="50"></textarea>
                <div class="suggestion-pills-container">
                    <div class="suggestion-pills-title">Sugesti Catatan</div>
                    <div class="suggestion-pills" id="suggestion-pills-container"></div>
                </div>
            </div>
        </div>
    </div>
</div>